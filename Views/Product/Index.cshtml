@model IEnumerable<productManagement.Models.Product>

@{
    ViewData["Title"] = "All Products";
    var currentPage = ViewBag.CurrentPage ?? 1;
    var totalPages = ViewBag.TotalPages ?? 1;

    var userRole = Context.Session.GetString("UserRole") ?? "User"; // Get role from session, default "User"
}
<style>
 

    .anayet {
        max-width: 1100px;
        margin: auto;
        background: white;
        padding: 2rem 2.5rem;
        border-radius: 12px;
        box-shadow: 0 12px 30px rgb(0 0 0 / 0.1);
    }


    h2 {
        font-weight: 700;
        font-size: 2rem;
        color: #111827; /* gray-900 */
        margin-bottom: 1.5rem;
        user-select: none;
    }

    .table-responsive {
        border-radius: 0.75rem;
        overflow-x: auto;
        overflow-y: visible; /* <=== FIX sticky header visibility */
        box-shadow: inset 0 0 8px rgb(0 0 0 / 0.05);
    }

    table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 0;
        font-size: 0.95rem;
        color: #374151; /* gray-700 */
        min-width: 700px;
    }

    thead th {
        position: sticky;
        top: 0;
        background: #1e40af; /* blue-800 */
        color: white;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        padding: 0.85rem 1rem;
        font-weight: 600;
        border-bottom: 3px solid #2563eb;
        user-select: none;
        z-index: 1;
    }

    tbody tr {
        background: #f9fafb;
        transition: background-color 0.25s ease;
    }

        tbody tr:nth-child(even) {
            background: white;
        }

        tbody tr:hover {
            background: #dbeafe; /* blue-100 */
        }

    tbody td {
        padding: 0.75rem 1rem;
        vertical-align: middle;
        border-bottom: 1px solid #e5e7eb; /* gray-200 */
    }

    img.img-thumbnail {
        max-height: 50px;
        border-radius: 0.5rem;
        box-shadow: 0 2px 8px rgb(59 130 246 / 0.3);
        object-fit: cover;
        width: auto;
    }

    /* Buttons */
    .btn {
        border-radius: 0.5rem;
        padding: 0.35rem 0.75rem;
        font-weight: 600;
        font-size: 0.875rem;
        transition: background-color 0.3s ease, box-shadow 0.3s ease;
        user-select: none;
        min-width: 65px;
    }

    .btn-primary {
        background-color: #2563eb; /* blue-600 */
        color: white;
        border: none;
        box-shadow: 0 3px 8px rgb(37 99 235 / 0.4);
    }

        .btn-primary:hover {
            background-color: #1d4ed8; /* blue-700 */
            box-shadow: 0 5px 15px rgb(29 78 216 / 0.6);
        }

    .btn-info {
        background-color: #0ea5e9; /* sky-500 */
        color: white;
        border: none;
        box-shadow: 0 3px 8px rgb(14 165 233 / 0.4);
    }

        .btn-info:hover {
            background-color: #0284c7; /* sky-600 */
            box-shadow: 0 5px 15px rgb(2 132 199 / 0.6);
        }

    .btn-danger {
        background-color: #dc2626; /* red-600 */
        color: white;
        border: none;
        box-shadow: 0 3px 8px rgb(220 38 38 / 0.4);
    }

        .btn-danger:hover {
            background-color: #b91c1c; /* red-700 */
            box-shadow: 0 5px 15px rgb(185 28 28 / 0.6);
        }

    .btn-success {
        background-color: #16a34a; /* green-600 */
        color: white;
        border: none;
        box-shadow: 0 3px 8px rgb(22 163 74 / 0.4);
    }

        .btn-success:hover {
            background-color: #15803d; /* green-700 */
            box-shadow: 0 5px 15px rgb(21 128 61 / 0.6);
        }

    /* Pagination */
    nav[aria-label="Product pagination"] {
        margin-top: 2rem;
        user-select: none;
    }

    .pagination {
        justify-content: center;
    }

    .page-item.active .page-link {
        background-color: #2563eb;
        border-color: #2563eb;
        color: white;
        font-weight: 700;
        box-shadow: 0 4px 12px rgb(37 99 235 / 0.6);
    }

    .page-link {
        color: #374151;
        font-weight: 600;
        border-radius: 0.5rem;
        border: 1px solid transparent;
        transition: background-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        padding: 0.4rem 0.9rem;
    }

        .page-link:hover {
            background-color: #e0e7ff;
            color: #2563eb;
            border-color: #c7d2fe;
            box-shadow: 0 4px 12px rgb(99 102 241 / 0.5);
            text-decoration: none;
        }

    /* Alert info */
    .alert-info {
        font-weight: 600;
        background-color: #e0f2fe;
        border-color: #bae6fd;
        color: #0284c7;
        border-radius: 0.75rem;
        padding: 1rem 1.25rem;
        box-shadow: 0 2px 10px rgb(14 165 233 / 0.3);
        user-select: none;
    }

    /* Add new product button */
    .mt-3 > a.btn-success {
        border-radius: 0.75rem;
        padding: 0.6rem 1.3rem;
        font-weight: 700;
        font-size: 1rem;
        box-shadow: 0 5px 20px rgb(22 163 74 / 0.4);
        transition: box-shadow 0.3s ease, background-color 0.3s ease;
    }

        .mt-3 > a.btn-success:hover {
            background-color: #15803d;
            box-shadow: 0 7px 30px rgb(21 128 61 / 0.7);
        }
</style>
<div class="anayet">
    <h2 class="my-4">All Products</h2>

    @if (Model.Any())
    {
        <div class="table-responsive shadow-sm rounded">
            <table class="table table-striped table-bordered table-hover mb-0">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Name</th>
                        <th>Description</th>
                        <th>Price</th>
                        <th>Image</th>
                        <th class="text-center">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var product in Model)
                    {
                        <tr>
                            <td>@product.Id</td>
                            <td>@product.Name</td>
                            <td>@product.Description</td>
                            <td>@product.Price.ToString("C")</td>
                            <td>
                                @if (!string.IsNullOrEmpty(product.ImagePath))
                                {
                                    <img src="@product.ImagePath" alt="@product.Name" class="img-thumbnail" />
                                }
                                else
                                {
                                    <span class="text-muted">No image</span>
                                }
                            </td>
                            <td class="text-center">
                                <a asp-action="Details" asp-route-id="@product.Id" asp-controller="Product" class="btn btn-sm btn-info" title="Details">
                                    <i class="bi bi-info-circle"></i> Details
                                </a>
                                <a asp-controller="Order" asp-action="Create" asp-route-productId="@product.Id" class="btn btn-sm btn-success" title="Order">
                                    <i class="bi bi-cart-plus"></i> Order
                                </a>

                                @if (userRole == "Admin")
                                {
                                    <a asp-action="Edit" asp-route-id="@product.Id" class="btn btn-sm btn-primary" title="Edit">
                                        <i class="bi bi-pencil-square"></i> Edit
                                    </a>
                                    <a asp-action="Delete" asp-route-id="@product.Id" class="btn btn-sm btn-danger" title="Delete">
                                        <i class="bi bi-trash"></i> Delete
                                    </a>
                                }
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>

        <nav aria-label="Product pagination">
            <ul class="pagination">
                @if (currentPage > 1)
                {
                    <li class="page-item">
                        <a class="page-link" asp-action="Index" asp-route-page="1" aria-label="First">
                            <span aria-hidden="true">&laquo;&laquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" asp-action="Index" asp-route-page="@(currentPage - 1)" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                }

                @for (int i = 1; i <= totalPages; i++)
                {
                    <li class="page-item @(currentPage == i ? "active" : "")">
                        <a class="page-link" asp-action="Index" asp-route-page="@i">@i</a>
                    </li>
                }

                @if (currentPage < totalPages)
                {
                    <li class="page-item">
                        <a class="page-link" asp-action="Index" asp-route-page="@(currentPage + 1)" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" asp-action="Index" asp-route-page="@totalPages" aria-label="Last">
                            <span aria-hidden="true">&raquo;&raquo;</span>
                        </a>
                    </li>
                }
            </ul>
        </nav>
    }
    else
    {
        <div class="alert alert-info" role="alert">
            No products found. Would you like to <a asp-action="Create" class="alert-link">add a new product</a>?
        </div>
    }

    @if (userRole == "Admin")
    {
        <div class="mt-3">
            <a asp-action="Create" class="btn btn-success">Add New Product</a>
        </div>
    }

</div>
